<!-- This is a static file -->
<!-- served from your routes in server.js -->

<!DOCTYPE html>
<html>
  <head>
    <title>My p5 thing.</title>
    <meta name="description" content="p5.js CDN Template" />
    <script src="https://cdn.jsdelivr.net/npm/p5@1.3.0/lib/p5.js"></script>
    <!--script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.0/addons/p5.dom.js"></script-->
    <!--script src="/sketch.js"></script-->
  </head>
  <body>

      <h1 id="hour">
        big
      </h1>
      <h1 id="min">
        bird
      </h1>
      <h1 id="sec">
        test
      </h1>

    <div class="glitchButton" style="position:fixed;top:20px;right:20px;"></div>
    <script
      src="https://button.glitch.me/button.js"
      data-style="glitch"
    ></script>
    <script>
      var lastTime = new Date(0);
      function changeTime() {
        var now = new Date();
        if (now.getHours() != lastTime.getHours()) {
          fetch("/birdNum?num=" + now.getHours()) // Call the fetch function passing the url of the API as a parameter
            .then(function(response) {
              response.text().then(function(text) {
                try {
                  var bj = JSON.parse(text);
                  document.getElementById("hour").innerHTML = 
                    bj.howMany + " " + bj.comName;
                } catch (e) {
                }
              });
            })
            .catch(function() {
            });
        }
        if (now.getMinutes() != lastTime.getMinutes()) {
          fetch("/birdNum?num=" + now.getMinutes()) // Call the fetch function passing the url of the API as a parameter
            .then(function(response) {
              response.text().then(function(text) {
                try {
                  var bj = JSON.parse(text);
                  document.getElementById("min").innerHTML = 
                    bj.howMany + " " + bj.comName;
                } catch (e) {
                }
              });
            })
            .catch(function() {
            });
        }
        if (now.getSeconds() != lastTime.getSeconds()) {
          fetch("/birdNum?num=" + now.getSeconds()) // Call the fetch function passing the url of the API as a parameter
            .then(function(response) {
              response.text().then(function(text) {
                try {
                  var bj = JSON.parse(text);
                  console.log(bj);
                  document.getElementById("sec").innerHTML = 
                    bj.howMany + " " + bj.comName + "<img src='" + bj.image + "'>";
                } catch (e) {
                }
              });
            })
            .catch(function() {
            });
        }
        lastTime = now;
      }

      setInterval(changeTime, 1000);
    </script>
  </body>
</html>
